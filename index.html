<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>PeerJS Audio Chat</title>
    <!-- Import PeerJS library -->
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
  </head>
  <body>
    <h1>PeerJS Audio Chat</h1>
    <p>Call Peer ID: <input id="peer-id" type="text" placeholder="Enter namr" /></p>
    <p>Call Peer ID: <input id="call-peer-id" type="text" placeholder="Enter name to call" /></p>
    <p><button id="name-button" onclick="setname()">set name</button></p>

    <p><button id="call-button">Call</button></p>
    <p><button id="mute-button">Mute/Unmute</button></p>
    <div id="audio-container"></div>
    <script>
      // Get the UI elements
      const callPeerIdInput = document.getElementById("call-peer-id");
      const callButton = document.getElementById("call-button");
      const muteButton = document.getElementById("mute-button");
      const audioContainer = document.getElementById("audio-container");

      function setname(){ let peer = new Peer({host:'peerjs-server.herokuapp.com', secure:true, port:443})

  
}) ; 
      // Get the local audio stream
      navigator.mediaDevices
        .getUserMedia({ audio: true })
        .then((localStream) => {
          // Store the stream in the variable
          stream = localStream;

          // Listen for incoming calls
          peer.on("call", (call) => {
            // Answer the call with the local stream
            call.answer(stream);

            // Log the call
            console.log("Answered call from:", call.peer);

            // Listen for the remote stream
            call.on("stream", (remoteStream) => {
              // Log the remote stream
              console.log("Got remote stream from:", call.peer, remoteStream);

              // Create a new audio element for the remote stream
              const audio = document.createElement("audio");
              audio.srcObject = remoteStream;
              audio.autoplay = true;

              // Add the audio element to the audio container
              audioContainer.appendChild(audio);
            });

            // Handle errors and disconnections
            call.on("error", (error) => {
              console.log("Error in call with:", call.peer, error);
            });

            call.on("close", () => {
              console.log("Call closed with:", call.peer);
            });
          });

          // Get the peer ID
          peer.on("open",  (id) => {
             console.log(id)
            mayPeerIdSpan.innerHTML = id;
          });
        })
        .catch((error) => {
          // Log the error
          console.error("Error getting local audio stream:", error);
        });
      // Create a new Peer instance
      
      // Declare a variable to store the local stream



      // Add a click listener to the call button
      callButton.addEventListener("click", () => {
        // Get the call peer ID from the input
        const callPeerId = callPeerIdInput.value;

        // Check if the call peer ID is valid
        if (callPeerId) {
          // Call the peer with the local stream
          const call = peer.call(callPeerId, stream);

          // Log the call
          console.log("Called peer:", call.peer);

          // Listen for the remote stream
          call.on("stream", (remoteStream) => {
            // Log the remote stream
            console.log("Got remote stream from:", call.peer, remoteStream);

            // Create a new audio element for the remote stream
            const audio = document.createElement("audio");
            audio.srcObject = remoteStream;
            audio.autoplay = true;

            // Add the audio element to the audio container
            audioContainer.appendChild(audio);
          });

          // Handle errors and disconnections
          call.on("error", (error) => {
            console.log("Error in call with:", call.peer, error);
          });

          call.on("close", () => {
            console.log("Call closed with:", call.peer);
          });
        }
      });

      // Add a click listener to the mute button
      muteButton.addEventListener("click", () => {
        // Check if the stream is available
        if (stream) {
          // Get the audio track from the stream
          const audioTrack = stream.getAudioTracks()[0];

    // Toggle the enabled property of the audio track
    audioTrack.enabled = !audioTrack.enabled;

// Log the mute status
console.log("Muted:", !audioTrack.enabled);
}
});}
</script>
</body>
</html>
